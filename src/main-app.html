<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="question-component.html">
<link rel="import" href="list-component.html">
<link rel="import" href="full-description-component.html">
<link rel="import" href="intro-component.html">
<link rel="import" href="/bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto:100,400" rel="stylesheet">

<dom-module id="main-app">
  <template>
    <style>
     :host {
        display: block;
        margin:0;
        padding:0;
     }
     .positive {
          /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#66bb6a+0,4db6ac+77,4db6ac+100 */
          background: #66bb6a; /* Old browsers */
          background: -moz-linear-gradient(top, #66bb6a 0%, #4db6ac 77%, #4db6ac 100%); /* FF3.6-15 */
          background: -webkit-linear-gradient(top, #66bb6a 0%,#4db6ac 77%,#4db6ac 100%); /* Chrome10-25,Safari5.1-6 */
          background: linear-gradient(to bottom, #66bb6a 0%,#4db6ac 77%,#4db6ac 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
          filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#66bb6a', endColorstr='#4db6ac',GradientType=0 ); /* IE6-9 */
          margin:0;
          padding:0;
     }
     .negative{
        /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#d01a25+0,d81b60+87,d81b60+100 */
        background: #d01a25; /* Old browsers */
        background: -moz-linear-gradient(top, #d01a25 0%, #d81b60 87%, #d81b60 100%); /* FF3.6-15 */
        background: -webkit-linear-gradient(top, #d01a25 0%,#d81b60 87%,#d81b60 100%); /* Chrome10-25,Safari5.1-6 */
        background: linear-gradient(to bottom, #d01a25 0%,#d81b60 87%,#d81b60 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#d01a25', endColorstr='#d81b60',GradientType=0 ); /* IE6-9 */
        margin:0;
        padding:0;
     }
     .results{
        /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#3949ab+0,039be5+80,039be5+100 */
        background: #3949ab; /* Old browsers */
        background: -moz-linear-gradient(top, #3949ab 0%, #039be5 80%, #039be5 100%); /* FF3.6-15 */
        background: -webkit-linear-gradient(top, #3949ab 0%,#039be5 80%,#039be5 100%); /* Chrome10-25,Safari5.1-6 */
        background: linear-gradient(to bottom, #3949ab 0%,#039be5 80%,#039be5 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#3949ab', endColorstr='#039be5',GradientType=0 ); /* IE6-9 */
     }
     .intro{
        /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#3949ab+0,039be5+80,039be5+100 */
        background: #3949ab; /* Old browsers */
        background: -moz-linear-gradient(top, #3949ab 0%, #039be5 80%, #039be5 100%); /* FF3.6-15 */
        background: -webkit-linear-gradient(top, #3949ab 0%,#039be5 80%,#039be5 100%); /* Chrome10-25,Safari5.1-6 */
        background: linear-gradient(to bottom, #3949ab 0%,#039be5 80%,#039be5 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#3949ab', endColorstr='#039be5',GradientType=0 ); /* IE6-9 */
     }
    </style>
    
    <app-location route="{{route}}" use-hash-as-path="">
    </app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}">
    </app-route>
    <iron-pages selected="[[currentView]]" attr-for-selected="name" role="main">
        <intro-component user-location="{{userLocation}}" class="intro" name="intro" current-view="{{currentView}}">
        </intro-component>
        <question-component answers="{{queryParams}}" question-type="Positive" class="positive" name="first" current-view="{{currentView}}" on-server-call="findPark" options="[[options]]">
        </question-component>
        <question-component answers="{{queryParams}}" question-type="Negative" class="negative" name="second" current-view="{{currentView}}" on-server-call="findPark" options="[[options]]">
        </question-component>
        <list-component name="third" results="[[results]]" current-view="{{currentView}}" park="{{choice}}" class="results" location="{{userLocation}}">
        </list-component>
        <full-description-component name="fourth" park="[[choice]]" current-view="{{currentView}}" class="results" has-list="{{isList}}" location="{{userLocation}}">
        </full-description-component>
    </iron-pages>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class MainApp extends Polymer.Element {
      static get is() { return 'main-app'; }
      static get properties() {
        return {
          userLocation: {
            type: Object,
            value: {
              latitude : '',
              longitude : '',
            },
            notify:true
          },
          chosenQuestion: {
            type: String,
            value: 'negative'
          },
          queryParams: {
            type: Array,
            value: []
          },
          currentView: { 
            type: String,
            value: 'intro',
            notify:true,
            observer:"currentViewChanged"
          },
          results: {
            type: Array,
            notify: true,
          },
          choice: {
            type: Object,
            notify: true,
            observer:'choiceChanged',
          },
          isList: {
            type: Boolean,
            notify: true
          },
          options: {
              type: Array,
              value: () => ["Lots of space","Playground for Children","Excercise Area","Open space for Pets"]
          },
        };
      }

      static get observers() {
        return [
          'routePageChanged(routeData.page)'
        ];
      }

      routePageChanged(path) {
        this.currentView = path || 'intro';
      }

      currentViewChanged(name) {
        this.currentView = name
        window.history.pushState({}, null, '#/' + name);
        window.dispatchEvent(new CustomEvent('location-changed'));
      }

      findPark(){
          //this will be replaced by the actual server query!
          console.log('query params are ');
          console.log(this.queryParams);
          console.log(this.userLocation);
          console.log('calling server!');

          this.results = [
                    {
                      "WKT": "MULTIPOLYGON (((-58.46781121129 -34.657587374526,-58.4694893632448 -34.6589757263203,-58.4694981833603 -34.6589818569724,-58.469504123315 -34.6589844713935,-58.4695107831871 -34.6589864546269,-58.4695169029723 -34.6589870854321,-58.4695243726692 -34.6589873555058,-58.4695310322165 -34.6589853715276,-58.4695362516708 -34.6589814941884,-58.4695405710749 -34.658976534933,-58.4695427305878 -34.6589717561264,-58.4695417400753 -34.6589649938912,-58.4695338194009 -34.6589525517205,-58.4695301291562 -34.658947592914,-58.4695253589965 -34.6589430849873,-58.4687577365155 -34.6583067488655,-58.4678589969198 -34.6575633889169,-58.4678506270313 -34.6575569876341,-58.4678432471507 -34.6575516682756,-58.4678375773284 -34.6575489635977,-58.4678317275674 -34.6575470704022,-58.4678253379561 -34.657547070671,-58.4678202982904 -34.6575475217022,-58.4678152586856 -34.6575489645361,-58.4678103991195 -34.6575512188373,-58.4678069795597 -34.6575550058643,-58.4678042799503 -34.6575587026971,-58.4678026603636 -34.6575638421071,-58.4678018507222 -34.6575688913192,-58.4678017610591 -34.6575743011568,-58.4678034712265 -34.6575787191161,-58.4678063512847 -34.6575825058792,-58.46781121129 -34.657587374526)))",
                      "NAME": "PARQUE AVELLANEDA",
                      "KIND": "PARQUE",
                      "HAS_PLAYGROUND": "FALSE",
                      "ADDRESS": "SANTIAGO DE COMPOSTELA, AV. E/ AMEGHINO, FLORENTINO, DR. Y ASTURIAS",
                      "NEIGHBORHOOD": "PARQUE AVELLANEDA",
                      "NOM_MAP": "",
                      "AREA": 1105.765,
                      "PERIMETER": 100,
                      "PETS": "TRUE",
                      "EXCERCISE": "FALSE",
                      "IMG": "https://4.bp.blogspot.com/-8VciOj6nhZU/T-YFo8ntPcI/AAAAAAAAEpw/EaExQa5fwog/s1600/2012-06-23_14-17-10_690.jpg",
                      "PLACEHOLDERIMG":"data:image/jpeg;base64,/9j/4QlQaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MiA3OS4xNjA5MjQsIDIwMTcvMDcvMTMtMDE6MDY6MzkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiLz4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8P3hwYWNrZXQgZW5kPSJ3Ij8+/+0ALFBob3Rvc2hvcCAzLjAAOEJJTQQlAAAAAAAQ1B2M2Y8AsgTpgAmY7PhCfv/bAIQACAYGBgYGCAYGCAwIBwgMDgoICAoOEA0NDg0NEBEMDg0NDgwRDxITFBMSDxgYGhoYGCMiIiIjJycnJycnJycnJwEJCAgJCgkLCQkLDgsNCw4RDg4ODhETDQ0ODQ0TGBEPDw8PERgWFxQUFBcWGhoYGBoaISEgISEnJycnJycnJycn/90ABAAB/+4ADkFkb2JlAGTAAAAAAf/AABEIAAkAEAMAIgABEQECEQH/xABiAAEBAQAAAAAAAAAAAAAAAAAFAgMBAQEAAAAAAAAAAAAAAAAAAAEDEAACAQQBAgcAAAAAAAAAAAACAwEABBESBSExIjNDYXGRwREAAgMBAAAAAAAAAAAAAAAAAAISFDFR/9oADAMAAAERAhEAPwAS1nk0phbuJWy7U1bHum5KIhAQWiFAMRERkty696u9uuevwIkrboDFzbFJlM6AUHjTw64xj3706fkj8ftY+t9VKy+DFeH/2Q=="
                     },
                    {
                      "WKT": "MULTIPOLYGON (((-58.4885571998889 -34.6537909125978,-58.4880199078463 -34.6533338941054,-58.4880112676313 -34.6533300188491,-58.48800325784 -34.6533277664125,-58.4879949785723 -34.6533271369826,-58.4879875098167 -34.6533284909911,-58.4879804912844 -34.6533307465453,-58.4879750929542 -34.6533342640587,-58.4879699650039 -34.6533391339752,-58.4879650191121 -34.6533508563144,-58.4879645708584 -34.6533564465726,-58.4879653824098 -34.6533618562419,-58.4879695235091 -34.6533669947293,-58.4882923128315 -34.6536440914044,-58.4885248188728 -34.6538410506161,-58.4885340889305 -34.6538443847186,-58.4885423683656 -34.6538453747676,-58.4885511874361 -34.6538453728982,-58.4885583859773 -34.6538431172731,-58.488565584126 -34.6538395993524,-58.4885715219588 -34.6538346390755,-58.4885757496912 -34.6538287775217,-58.4885769178303 -34.653823187109,-58.4885759256653 -34.6538158840396,-58.4885734032141 -34.6538071386717,-58.4885682721044 -34.6538018200874,-58.4885571998889 -34.6537909125978)))",
                      "NAME": "PARQUE GARZON",
                      "KIND": "PLAZA",
                      "HAS_PLAYGROUND": "FALSE",
                      "ADDRESS": "GARZON, EUGENIO AV. E/ BASUALDO Y ARAUJO",
                      "NEIGHBORHOOD": "MATADEROS",
                      "NOM_MAP": "",
                      "AREA": 459.073,
                      "PERIMETER": 9980,
                      "PETS": "FALSE",
                      "EXCERCISE": "TRUE",
                      "IMG": "http://3.bp.blogspot.com/-YlFd9Drw6EQ/Upyk7Cn7hOI/AAAAAAAACzg/1lbR28lVMiw/s1600/Jacaranda++blooming.JPG",
                      "PLACEHOLDERIMG":"data:image/jpeg;base64,/9j/4QlQaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MiA3OS4xNjA5MjQsIDIwMTcvMDcvMTMtMDE6MDY6MzkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiLz4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8P3hwYWNrZXQgZW5kPSJ3Ij8+/+0ALFBob3Rvc2hvcCAzLjAAOEJJTQQlAAAAAAAQ1B2M2Y8AsgTpgAmY7PhCfv/bAIQACAUFBQYFCAYGCAsHBgcLDQoICAoNDwwMDQwMDxEMDQ0NDQwRDxESExIRDxcXGRkXFyIhISEiJiYmJiYmJiYmJgEICQkQDhAdFBQdIBoVGiAmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYm/90ABAAC/+4ADkFkb2JlAGTAAAAAAf/AABEIAAsAEAMAEQABEQECEQH/xABqAAADAQAAAAAAAAAAAAAAAAADBAUGAQEBAQEAAAAAAAAAAAAAAAACBAMFEAACAgECBgMBAAAAAAAAAAABAgMEEQAhBRITIjFxBgcyUhEAAgEEAwEAAAAAAAAAAAAAAQIAAwQRMRITFEH/2gAMAwAAARECEQA/AIt37LjuMZDVCVJMdJIgzc8vgszgbZyF/PvfVa3rHJM5lKzCfYq3GZbFA2YqVuHAeVS8DKjiIZlAfYYjz7I3Oj7ZYtPjuf/Q0cdqXoRz9gldCjMEQdvMpxgDA31EUBJGIkqMBkGB+U8OqWnjjnVnSJpJUXncAOigKe1h/R28aKqBqb9rNsz/2Q=="
                    }
          ];

          if(this.results.length > 1){
            this.currentView = 'third';
            this.isList = true;
          } else{
            this.currentView = 'fourth';
            this.isList = false;
            this.choice = this.results[0];
            this.parsePolygonData(this.choice);
          };
        };

        parsePolygonData(data){
          let polygonData = data.WKT;
          let m = polygonData.match(/\([^\(\)]+\)/g);
          if(!m){
            return;
          };
          for(let point of m){
            let tmp = point.match(/-?\d+\.?\d*/g);
            this.set('choice.WKT',[])
            if(tmp){
              for(let i= 0; i < tmp.length; i++){
                let tmpArr = [];
                let lat = Number(tmp[i + 1]);
                let long = Number(tmp[i])
                let point = {
                  latitude:'',
                  longitude:''
                };
                point.latitude =  lat;
                this.notifyPath('point.latitude');
                point.longitude = long;
                this.notifyPath('point.longitude');
                this.push('choice.WKT', point);
              };
              this.choice.latitude = this.choice.WKT[0].latitude;
              this.notifyPath('choice.latitude');
              this.choice.longitude = this.choice.WKT[0].longitude;
              this.notifyPath('choice.longitude');
            };
          };
        };

        choiceChanged(){
          this.parsePolygonData(this.choice);
        };
    };

    window.customElements.define(MainApp.is, MainApp);
  </script>
</dom-module>
